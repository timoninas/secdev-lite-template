# S04 - Приоритизация рисков (объединённый проект)

| Risk ID | Source | Consolidated Description | Threat | NFR link | L | Rationale-L | I | Rationale-I | Score | Top-5? | ADR candidate |
|----------|---------|--------------------------|---------|-----------|--:|--------------|--:|--------------|--:|--------|---------------|
| R-01 | Auth (S1) | Утечка токена сброса пароля в логах | I | NFR-003-4 | 3 | Требует доступа к логам | 4 | Компрометация учётных записей | 12 | Yes | Mask tokens in logs |
| R-02 | API | Массовые запросы на импорт/экспорт (DoS) | D | NFR-013-5, NFR-014-2 | 4 | Публичный API, легко автоматизировать | 3 | Отказ в обслуживании, задержки | 12 | Yes | Global RateLimit + Queue |
| R-03 | Export (S3) | Утечка персональных данных при экспорте | I | NFR-014-1 | 3 | Ошибка роли или флага include_pii | 5 | Массовая утечка персональных данных | 15 | Yes | Role-based filter PII |
| R-04 | Import (S2) | Загрузка невалидных CSV с вредоносным контентом | T | NFR-013-1 | 4 | CSV можно подменить до валидации | 4 | Повреждение данных и XSS в BI | 16 | Yes | Schema + sanitize CSV |
| R-05 | Auth (U) | Фишинговые письма со ссылками сброса пароля | S | NFR-003-2 | 3 | Распространённая угроза через почту | 5 | Кража учётных данных пользователей | 15 | Yes | Signed HTTPS reset link |
| R-06 | Database | Хранение CSV без шифрования | I | need NFR | 2 | Внутренний доступ, редкий сценарий | 4 | Возможная утечка клиентских данных | 8 | No | AES-256 at rest |
| R-07 | API | Ошибки возвращают лишние поля (stacktrace) | I | NFR-013-6 | 3 | Не во всех контроллерах обработка ошибок | 3 | Утечка внутренней структуры сервиса | 9 | No | RFC7807 middleware |
| R-08 | SMTP | Повторные письма при сбое внешнего API | D | need NFR | 3 | Зависит от надёжности провайдера | 2 | Повышенная нагрузка, не критично | 6 | No | Retry + CircuitBreaker |
| R-09 | DB | Нет аудита изменений в импорте/экспорте | R | NFR-013-10, NFR-014-7 | 2 | Логирование не везде включено | 3 | Потеря трассировки действий | 6 | No | Unified audit log |
| R-10 | Export | Долгие выгрузки блокируют сервер | D | NFR-014-3 | 3 | Увеличение объёма данных | 3 | Замедление отклика API | 9 | No | Async export job |

---

## Топ-5 рисков

| Rank | Risk | Причина высокой оценки | ADR candidate |
|------|------|------------------------|---------------|
| 1 | R-04 | Вредоносный CSV (Tampering) — высокая вероятность и серьёзный ущерб | Schema + sanitize CSV |
| 2 | R-03 | Утечка персональных данных при экспорте — критичный ущерб приватности | Role-based filter PII |
| 3 | R-05 | Фишинговые письма сброса пароля — высокая частота и тяжёлые последствия | Signed HTTPS reset link |
| 4 | R-01 | Утечка токенов сброса в логах — прямая компрометация аккаунтов | Mask tokens in logs |
| 5 | R-02 | Массовые DoS-запросы — угроза доступности сервиса | Global RateLimit + Queue |
