# S05 - Матрица вариантов (Option Matrix) 

## 1) Контекст риска (из S04)

* **Risk-ID:** `R-04 (Вредоносный CSV (Tampering))`     **Threat:** `I`
* **DFD element/edge:** `U --> A, A --> S2, S2 --> D`
* **NFR link (ID):** `NFR-013-1, NFR-013-2`
* **L×I (1-5):** `L=4, I=4, Score=16`
* **Ограничения/предпосылки:** Импорт файлов формата .csv по HTTP, при росте нагрузки ×2 P95 растёт ≤1.2×; 5xx ≤1 %

## 2) Таблица сравнения вариантов

| Alternative | Summary (1-2 фразы)            | Security impact (↑,1-5) | Blast radius reduction (↑,1-5) | Complexity (↓,1-5) | Time-to-mitigate (↓,1-5) | Dependencies (↓,1-5) | **Benefit** | **Cost** | **Net** | Notes |
| ----------- |--------------------------------|------------------------:|-------------------------------:|-------------------:|-------------------------:|---------------------:|------------:|---------:|--------:| ----- |
| A           | Input Validation & Size Limits |                       5 |                              4 |                  3 |                        2 |                    2 |           9 |        7 |       2 |       |
| B           | API Gateway schema validation  |                       4 |                              4 |                  4 |                        3 |                    3 |           8 |       10 |      -2 |       |

---

## 3) Решение (для переноса в ADR)

* **Chosen alternative:** `<A>`
* **Почему:** Вариант A дешевле и предоставляет схожий уровень защиты. Вариант B можно рассматривать как дополнение 
* **ADR candidate (название):** `Input Validation & Size Limits `
* **Связки:** Risk-ID `R-04`, NFR-ID `NFR-013-1, NFR-013-2`, DFD `U --> A, A --> S2, S2 --> D`
* **Следующие шаги (минимум):**
  1. Если есть доп. поля → 400, выходит за рамки по памяти → 413
  2. Реализация на уровне S2 DTO-schema (server-side), unified error format
  3. Даты → UTC ISO-8601; строки → NFC; телефоны → E.164. Отклонение записей не прошедших по формату
  4. Все шаги импорта логируются в JSON с correlation_id
  5. Добавление e2e тестов на корректный ипорт/импорт с доп. полями/большие файлы
